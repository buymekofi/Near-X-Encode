<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuyMeKofi</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="icon" type="image/x-icon" href="https://img.icons8.com/external-vitaliy-gorbachev-lineal-color-vitaly-gorbachev/30/000000/external-cup-fast-food-vitaliy-gorbachev-lineal-color-vitaly-gorbachev.png">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@1,700&display=swap" rel="stylesheet">  
    <link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/near-api-js@0.41.0/dist/near-api-js.min.js"></script>
    <style>

    </style>

</head>

<body>
     
    <nav class="navbar navbar-expand-md navbar-light bg-white">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"><i><img src="https://img.icons8.com/external-vitaliy-gorbachev-lineal-color-vitaly-gorbachev/30/000000/external-cup-fast-food-vitaliy-gorbachev-lineal-color-vitaly-gorbachev.png"/></i></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span> </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item li-color">
                      <a class="nav-link" href="#">User Profile </i></a>
                      
                    </li>
                </ul>
                <div>
 
                </div>
            </div>
            </div>
          </div>
        </div>
          
        
    </nav>
    <hr>
    
    <center>
        <img src="{% static 'images/avatar.png' %}" alt="Boss" style="width:15%" class="w3-circle w3-hover-opacity">
    </center>
    <div class="w3-opacity">
        <span class="w3-button w3-xxlarge w3-white w3-right" onclick="w3_open()"><i class="fa fa-bars"></i></span> 
        <div class="w3-clear"></div>

        <header class="w3-center w3-margin-bottom">
          <h1><b>{{username}}</b></h1>
          <p><b>{{about}}</b></p>
          <p class="w3-padding-16"><button class="w3-button w3-black" onclick="myFunction()">Social Handle</button></p>
        </header>
        </div>
        <hr>
        <center>
        <h3 style="padding-bottom:0px"><b>Support Me!</h3></p>
        <br>
        <center>
            <img src="{% static 'images/NEAR-coffee.png' %}" alt="Coffee" style="padding-top:0px;width:15%">
        </center>
        <div class="desc">
        <input type="number" id="amount" placeholder="Enter an amount"></input>
        <br><br>
        <button class="primary-text w3-btn btn-warning" id="buy_coffee">Buy Me a Coffee</button>
        </div>
    </center>
    <br><br>
    <hr>
    <footer>
        <center><p>BuyMeKofi</p></center>
        <center> <p class="footer__texto" style="font-weight: 400; font-size:12px">Copyright @ 2022</p></center>
      </footer>
      

</body>
<script>
    const account_id = "{{ walletaddr }}";
    // let account_id = "'" + temp + "'";
    console.log(account_id);

    const CONTRACT_ID = "buy_coffee.hex.testnet";
    // connect to NEAR
    const near = new nearApi.Near({
        keyStore: new nearApi.keyStores.BrowserLocalStorageKeyStore(),
        networkId: 'testnet',
        nodeUrl: 'https://rpc.testnet.near.org',
        walletUrl: 'https://wallet.testnet.near.org'
    });

    // connect to the NEAR Wallet
    const wallet = new nearApi.WalletConnection(near, 'Buy a coffee dapp');

    // connect to a NEAR smart contract
    const contract = new nearApi.Contract(wallet.account(), CONTRACT_ID, {
        viewMethods: ['check_balance'],
        changeMethods: ['buy_coffee_for', 'withdraw']
    });

    const button = document.getElementById('buy_coffee');
    if (!wallet.isSignedIn()) {
        button.textContent = 'SignIn with NEAR'
    }

    // Either sign in or buy coffee change method on button click
    document.getElementById('buy_coffee').addEventListener('click', () => {
        if (wallet.isSignedIn()) {
            contract.buy_coffee_for({
                args: { account_id: account_id },
                amount: nearApi.utils.format.parseNearAmount(
                    document.getElementById('amount').value
                )
            })
        } else {
            wallet.requestSignIn({
                contractId: CONTRACT_ID,
                methodNames: ['check_balance', 'buy_coffee_for', 'withdraw']
            });
        }
    });
</script>
</html>